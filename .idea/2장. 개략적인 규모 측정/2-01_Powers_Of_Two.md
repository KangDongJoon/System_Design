# 2장. 개략적인 규모 측정

## (1) 2의 제곱수

1. 최소 단위는 1바이트(8비트)
2. ASCII 문자 하나가 차지하는 메모리 크기가 1바이트

- 흔히 쓰이는 데이터 볼륨 단위

| 2의 제곱 | 근사치   | 이름     | 축약형 |
|-------|-------|--------|-----|
| 10    | 1천    | 1킬로바이트 | 1KB |
| 20    | 1백만   | 1메가바이트 | 1MB |
| 30    | 10억   | 1기가바이트 | 1GB |
| 40    | 1조    | 1테라바이트 | 1TB |
| 50    | 1000조 | 1페타바이트 | 1PB |

- 응답지연 값

| 연산명                                | 시간                    |
|------------------------------------|-----------------------|
| L1 캐시 참조                           | 0.5ns                 |
| 분기 예측 오류(branch mispredict         | 5ns                   |
| L2 캐시 참조                           | 7ns                   |
| 뮤텍스(mutex) 락/언락                    | 100ns                 |
| 주 메모리 참조                           | 100ns                 |
| Zippy로 1KB 압축                      | 10,000ns = 20μs       |
| 1 Gbps 네트워크로 2KB 전송                | 20,000ns = 20μs       |
| 메모리에서 1MB 순차적으로 read               | 250,000ns = 250μs     |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간         | 500,000ns = 500μs     |
| 디스크 탐색(seek)                       | 10,000,000ns = 10ms   |
| 네트워크에서 1MB 순차적으로 read              | 10,000,000ns = 10ms   |
| 디스크에서 1MB 순차적으로 read               | 30,000,000ns = 30ms   |
| 한 패킷의 CA(캘리포니아)로부터 네덜란드까지의 왕복 지연시간 | 150,000,000ns = 150ms |  |

> ns = 나노초, μs = 마이크로초, ms = 밀리초<br>
> 1나노초 = 10^-9초<br>
> 1마이크로초 = 10^-6초 = 1,000나노초<br>
> 1밀리초 = 10^-3초 = 1,000μs = 1,000,000ns

- 응답 시간의 시각화
![latency_visualization.jpg](../images/chapter2/latency_visualization.jpg)

- 핵심
  - 메모리는 빠르지만 디스크는 느리다.
  - 디스크 탐색은 가능한 피하라.
  - 단순한 압축 알고리즘은 빠르다.
  - 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
  - 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.


## (2) 가용성에 관계된 수치들

### 9의 개수와 시스템 장애시간 사이의 관계

| 가용률      | 하루당 장애시간  | 주당 장애시간   | 개월당 장애시간 | 연간 장애시간 |
|----------|-----------|-----------|----------|---------|
| 99%      | 14.40분    | 1.68시간    | 7.31시간   | 3.65일   |
| 99.9%    | 1.44분     | 10.08분    | 43.83분   | 8.77시간  |
| 99.99%   | 8.64초     | 1.01분     | 4.38분    | 52.60분  |
| 99.999%  | 864.00밀리초 | 6.05초     | 26.30초   | 5.26분   |
| 99.9999% | 86.40밀리초  | 604.80밀리초 | 2.63초    | 31.56초  |

### QPS 측정법

> $$ QPS = \frac{\text{처리된 커리 수}}{\text{측정 시간 (초)}} $$

가정)
- 월간 능동 사용자 3억명
- 50%가 매일 서비스 이용
- 일 평균 2건의 게시글 작성
- 미디어 포함 10%
- 데이터는 5년간 보존

추정)

QPS 추정치
- 일간 능동 사용자 = 3억 * 50% = 1.5억
- QPS = 1.5억 * 2게시글 / 24시간 / 3600초 = 약 3500
- 최대 QPS = 2 * QPS = 약 7000

미디어 저장을 위한 저장소 요구량
- 평균 게시글 크기
  - id에 64바이트
  - 텍스트에 140바이트
  - 미디어에 1MB
- 미디어 저장소 요구량 = 1.5억 * 2 * 10% * 1MB = 30TB/일
- 5년간 미디어를 보관하기 위한 저장소 요구량 = 30TB * 365 * 5 = 약 55PB
